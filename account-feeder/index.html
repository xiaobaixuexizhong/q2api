<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>Amazon Q è´¦å·æŠ•å–‚ Â· URL ç™»å½•</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    :root {
      --bg:#0a0e1a;
      --panel:#0f1420;
      --muted:#8b95a8;
      --text:#e8f0ff;
      --accent:#4f8fff;
      --border:#1a2332;
      --glow:rgba(79,143,255,.15);
    }
    * { box-sizing:border-box; }
    html, body { height:100%; margin:0; }
    body {
      padding:0 0 40px;
      background:radial-gradient(ellipse at top, #0f1624 0%, #0a0e1a 100%);
      color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Noto Sans,Arial,sans-serif;
      line-height:1.6;
    }
    h1,h2 { font-weight:700; letter-spacing:-.02em; margin:0; }
    h1 { font-size:28px; margin:24px 0 12px; background:linear-gradient(135deg,#4f8fff,#7b9fff); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    h2 { font-size:18px; margin:20px 0 16px; color:#c5d4ff; }
    .container { max-width:800px; margin:0 auto; padding:20px; }
    .panel {
      background:linear-gradient(145deg,rgba(15,20,32,.8),rgba(10,14,26,.9));
      border:1px solid var(--border);
      border-radius:16px;
      padding:24px;
      box-shadow:0 20px 60px rgba(0,0,0,.4),0 0 0 1px rgba(79,143,255,.08),inset 0 1px 0 rgba(255,255,255,.03);
      backdrop-filter:blur(12px);
      transition:transform .2s,box-shadow .2s;
    }
    .panel:hover { transform:translateY(-2px); box-shadow:0 24px 70px rgba(0,0,0,.5),0 0 0 1px rgba(79,143,255,.12),inset 0 1px 0 rgba(255,255,255,.04); }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    label { color:var(--muted); font-size:13px; font-weight:500; letter-spacing:.01em; }
    .field { display:flex; flex-direction:column; gap:8px; flex:1; min-width:200px; }
    input {
      background:rgba(12,16,28,.6);
      color:var(--text);
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px 14px;
      outline:none;
      transition:all .2s;
      font-size:14px;
      box-shadow:inset 0 1px 2px rgba(0,0,0,.2);
    }
    input:focus {
      border-color:var(--accent);
      box-shadow:0 0 0 3px var(--glow),inset 0 1px 2px rgba(0,0,0,.2);
      background:rgba(12,16,28,.8);
    }
    button {
      background:linear-gradient(135deg,#2563eb,#1e40af);
      color:#fff;
      border:none;
      border-radius:12px;
      padding:12px 20px;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      transition:all .2s;
      box-shadow:0 4px 16px rgba(37,99,235,.3),inset 0 1px 0 rgba(255,255,255,.1);
      position:relative;
      overflow:hidden;
    }
    button:before {
      content:'';
      position:absolute;
      top:0;left:0;right:0;bottom:0;
      background:linear-gradient(135deg,rgba(255,255,255,.1),transparent);
      opacity:0;
      transition:opacity .2s;
    }
    button:hover { transform:translateY(-1px); box-shadow:0 6px 20px rgba(37,99,235,.4),inset 0 1px 0 rgba(255,255,255,.15); }
    button:hover:before { opacity:1; }
    button:active { transform:translateY(0); }
    button:disabled { opacity:.5; cursor:not-allowed; transform:none; }
    .btn-secondary { background:linear-gradient(135deg,#1e293b,#0f172a); box-shadow:0 4px 16px rgba(15,23,42,.3),inset 0 1px 0 rgba(255,255,255,.05); }
    .btn-secondary:hover { box-shadow:0 6px 20px rgba(15,23,42,.4),inset 0 1px 0 rgba(255,255,255,.08); }
    .switch { position:relative; display:inline-block; width:50px; height:26px; }
    .switch input { opacity:0; width:0; height:0; }
    .slider {
      position:absolute;
      cursor:pointer;
      top:0;left:0;right:0;bottom:0;
      background:linear-gradient(135deg,#374151,#1f2937);
      transition:.3s;
      border-radius:26px;
      border:1px solid var(--border);
      box-shadow:inset 0 2px 4px rgba(0,0,0,.3);
    }
    .slider:before {
      position:absolute;
      content:"";
      height:20px;
      width:20px;
      left:3px;
      bottom:2px;
      background:linear-gradient(135deg,#f3f4f6,#e5e7eb);
      transition:.3s;
      border-radius:50%;
      box-shadow:0 2px 6px rgba(0,0,0,.3);
    }
    input:checked+.slider { background:linear-gradient(135deg,#3b82f6,#2563eb); box-shadow:0 0 12px rgba(59,130,246,.4),inset 0 2px 4px rgba(0,0,0,.2); }
    input:checked+.slider:before { transform:translateX(24px); }
    .code {
      background:rgba(13,18,24,.8);
      border:1px solid var(--border);
      border-radius:12px;
      padding:14px;
      color:#d8e8ff;
      max-height:400px;
      overflow:auto;
      white-space:pre-wrap;
      font-size:13px;
      line-height:1.6;
      box-shadow:inset 0 2px 4px rgba(0,0,0,.3);
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;
    }
    .code::-webkit-scrollbar { width:8px; height:8px; }
    .code::-webkit-scrollbar-track { background:rgba(0,0,0,.2); border-radius:4px; }
    .code::-webkit-scrollbar-thumb { background:rgba(79,143,255,.3); border-radius:4px; }
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    .panel { animation:fadeIn .4s ease-out; }
    .info-box {
      background:rgba(79,143,255,.1);
      border:1px solid rgba(79,143,255,.3);
      border-radius:12px;
      padding:16px;
      margin-bottom:20px;
      color:#c5d4ff;
      font-size:14px;
    }
    .info-box strong { color:#4f8fff; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ Amazon Q è´¦å·æŠ•å–‚</h1>

    <div class="info-box">
      <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br><br>
      <strong>æ–¹å¼ä¸€ï¼šURL ç™»å½•</strong><br>
      1. å¡«å†™è´¦å·æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰<br>
      2. ç‚¹å‡»"å¼€å§‹ç™»å½•"æŒ‰é’®ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ‰“å¼€æˆæƒé¡µé¢<br>
      3. åœ¨æˆæƒé¡µé¢å®Œæˆç™»å½•<br>
      4. è¿”å›æœ¬é¡µé¢ï¼Œç‚¹å‡»"ç­‰å¾…æˆæƒå¹¶åˆ›å»ºè´¦å·"æŒ‰é’®<br>
      5. ç­‰å¾…æœ€å¤š5åˆ†é’Ÿï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºè´¦å·å¹¶æŠ•å–‚åˆ°ä¸»æœåŠ¡<br><br>
      <strong>æ–¹å¼äºŒï¼šæ‰‹åŠ¨æŠ•å–‚</strong><br>
      ç›´æ¥åœ¨ä¸‹æ–¹è¡¨å•è¾“å…¥ clientIdã€clientSecretã€refreshToken å³å¯å¿«é€ŸæŠ•å–‚
    </div>

    <div class="panel">
      <h2>URL ç™»å½•ï¼ˆ5åˆ†é’Ÿè¶…æ—¶ï¼‰</h2>
      <div class="row">
        <div class="field">
          <label>è´¦å·æ ‡ç­¾ï¼ˆå¯é€‰ï¼‰</label>
          <input id="auth_label" placeholder="ä¾‹å¦‚ï¼šå¼ ä¸‰çš„è´¦å·" />
        </div>
      </div>
      <div class="row">
        <button onclick="startAuth()">ğŸš€ å¼€å§‹ç™»å½•</button>
        <button class="btn-secondary" onclick="claimAuth()">â³ ç­‰å¾…æˆæƒå¹¶åˆ›å»ºè´¦å·</button>
      </div>
      <div class="field">
        <label>ç™»å½•ä¿¡æ¯</label>
        <pre class="code" id="auth_info">å°šæœªå¼€å§‹</pre>
      </div>
    </div>

    <div class="panel" style="margin-top:20px">
      <h2>ğŸ“ æ‰‹åŠ¨æŠ•å–‚è´¦å·</h2>
      <div class="row">
        <div class="field"><label>labelï¼ˆå¯é€‰ï¼‰</label><input id="manual_label" placeholder="è´¦å·æ ‡ç­¾" /></div>
        <div class="field"><label>clientId</label><input id="manual_clientId" placeholder="å®¢æˆ·ç«¯ID" /></div>
      </div>
      <div class="row">
        <div class="field"><label>clientSecret</label><input id="manual_clientSecret" placeholder="å®¢æˆ·ç«¯å¯†é’¥" /></div>
        <div class="field"><label>refreshToken</label><input id="manual_refreshToken" placeholder="åˆ·æ–°ä»¤ç‰Œ" /></div>
      </div>
      <div class="row">
        <div class="field"><label>accessTokenï¼ˆå¯é€‰ï¼‰</label><input id="manual_accessToken" placeholder="è®¿é—®ä»¤ç‰Œ" /></div>
      </div>
      <div class="row">
        <button onclick="createSingle()">â• åˆ›å»ºå•ä¸ªè´¦å·</button>
      </div>
      <div class="field">
        <label>ç»“æœ</label>
        <pre class="code" id="manual_result">ç­‰å¾…æ“ä½œ</pre>
      </div>
    </div>

    <div class="panel" style="margin-top:20px">
      <h2>ğŸ“¦ æ‰¹é‡æŠ•å–‚è´¦å·</h2>
      <div class="field">
        <label>JSON æ•°ç»„ï¼ˆæ¯ä¸ªå¯¹è±¡åŒ…å« labelã€clientIdã€clientSecretã€refreshTokenã€accessTokenï¼‰</label>
        <textarea id="batch_json" style="min-height:200px;font-family:ui-monospace,monospace;background:rgba(12,16,28,.6);color:var(--text);border:1px solid var(--border);border-radius:12px;padding:12px 14px;outline:none;resize:vertical" placeholder='[
  {
    "label": "è´¦å·1",
    "clientId": "xxx",
    "clientSecret": "xxx",
    "refreshToken": "xxx",
    "accessToken": ""
  }
]'></textarea>
      </div>
      <div class="row">
        <button onclick="createBatch()">ğŸš€ æ‰¹é‡åˆ›å»ºè´¦å·</button>
      </div>
      <div class="field">
        <label>æ‰¹é‡ç»“æœ</label>
        <pre class="code" id="batch_result">ç­‰å¾…æ“ä½œ</pre>
      </div>
    </div>
  </div>

<script>
let currentAuth = null;

async function startAuth(){
  const body = {
    label: (document.getElementById('auth_label').value || '').trim() || null,
    enabled: true
  };
  try {
    const r = await fetch('/auth/start', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (!r.ok) throw new Error(await r.text());
    const j = await r.json();
    currentAuth = j;
    const info = [
      'âœ… æˆæƒæµç¨‹å·²å¯åŠ¨ï¼',
      '',
      'ğŸ“‹ éªŒè¯é“¾æ¥: ' + j.verificationUriComplete,
      'ğŸ”‘ ç”¨æˆ·ä»£ç : ' + (j.userCode || ''),
      'ğŸ†” ä¼šè¯ID: ' + j.authId,
      'â±ï¸  è¿‡æœŸæ—¶é—´: ' + j.expiresIn + 'ç§’',
      'ğŸ”„ è½®è¯¢é—´éš”: ' + j.interval + 'ç§’',
      '',
      'ğŸ‘‰ è¯·åœ¨æ–°çª—å£ä¸­æ‰“å¼€ä¸Šè¿°é“¾æ¥å®Œæˆç™»å½•ã€‚',
      'ğŸ‘‰ ç™»å½•å®Œæˆåï¼Œç‚¹å‡»ä¸‹æ–¹"ç­‰å¾…æˆæƒå¹¶åˆ›å»ºè´¦å·"æŒ‰é’®ã€‚'
    ].join('\n');
    const el = document.getElementById('auth_info');
    el.textContent = info;
    try { window.open(j.verificationUriComplete, '_blank'); } catch {}
  } catch(e){
    document.getElementById('auth_info').textContent = 'âŒ å¯åŠ¨å¤±è´¥ï¼š' + e;
  }
}

async function claimAuth(){
  if (!currentAuth || !currentAuth.authId) {
    alert('âš ï¸ è¯·å…ˆç‚¹å‡»"å¼€å§‹ç™»å½•"æŒ‰é’®');
    return;
  }
  const authInfo = document.getElementById('auth_info');
  const originalText = authInfo.textContent;
  authInfo.textContent = originalText + '\n\nâ³ æ­£åœ¨ç­‰å¾…æˆæƒå¹¶åˆ›å»ºè´¦å·ï¼ˆæœ€å¤š5åˆ†é’Ÿï¼‰...\nè¯·è€å¿ƒç­‰å¾…ï¼Œä¸è¦å…³é—­é¡µé¢...';

  try{
    const r = await fetch('/auth/claim/' + encodeURIComponent(currentAuth.authId), { method: 'POST' });
    if (!r.ok) {
      const errorText = await r.text();
      throw new Error(errorText);
    }
    const j = await r.json();

    if (j.status === 'completed' && j.account) {
      authInfo.textContent = 'ğŸ‰ è´¦å·åˆ›å»ºæˆåŠŸï¼è´¦å·å·²æŠ•å–‚åˆ°ä¸»æœåŠ¡ï¼\n\n' +
        'ğŸ“‹ è´¦å·ä¿¡æ¯ï¼š\n' +
        '  æ ‡ç­¾ï¼š' + j.account.label + '\n' +
        '  IDï¼š' + j.account.id + '\n' +
        '  çŠ¶æ€ï¼š' + (j.account.enabled ? 'âœ… å·²å¯ç”¨' : 'âš ï¸ å·²ç¦ç”¨') + '\n\n' +
        'æ„Ÿè°¢æ‚¨çš„æŠ•å–‚ï¼ğŸ™';

      // æ¸…ç©ºè¡¨å•
      document.getElementById('auth_label').value = '';
      currentAuth = null;
    } else {
      authInfo.textContent = 'å®Œæˆï¼š\n' + JSON.stringify(j, null, 2);
    }
  } catch(e){
    authInfo.textContent = originalText + '\n\nâŒ å¤±è´¥ï¼š' + e.message + '\n\nè¯·æ£€æŸ¥ï¼š\n1. æ˜¯å¦å·²åœ¨æˆæƒé¡µé¢å®Œæˆç™»å½•\n2. ä¸»æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ\n3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸';
  }
}

async function createSingle(){
  const label = document.getElementById('manual_label').value.trim();
  const clientId = document.getElementById('manual_clientId').value.trim();
  const clientSecret = document.getElementById('manual_clientSecret').value.trim();
  const refreshToken = document.getElementById('manual_refreshToken').value.trim();
  const accessToken = document.getElementById('manual_accessToken').value.trim();

  if (!clientId || !clientSecret || !refreshToken) {
    alert('âš ï¸ è¯·å¡«å†™å¿…å¡«å­—æ®µï¼šclientIdã€clientSecretã€refreshToken');
    return;
  }

  const result = document.getElementById('manual_result');
  result.textContent = 'â³ æ­£åœ¨åˆ›å»ºè´¦å·...';

  try {
    const r = await fetch('/accounts/create', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({
        label: label || null,
        clientId,
        clientSecret,
        refreshToken,
        accessToken: accessToken || null,
        enabled: true
      })
    });
    if (!r.ok) throw new Error(await r.text());
    const j = await r.json();
    result.textContent = 'ğŸ‰ è´¦å·åˆ›å»ºæˆåŠŸï¼\n\n' + JSON.stringify(j, null, 2);

    // æ¸…ç©ºè¡¨å•
    document.getElementById('manual_label').value = '';
    document.getElementById('manual_clientId').value = '';
    document.getElementById('manual_clientSecret').value = '';
    document.getElementById('manual_refreshToken').value = '';
    document.getElementById('manual_accessToken').value = '';
  } catch(e){
    result.textContent = 'âŒ åˆ›å»ºå¤±è´¥ï¼š' + e.message;
  }
}

async function createBatch(){
  const jsonText = document.getElementById('batch_json').value.trim();
  if (!jsonText) {
    alert('âš ï¸ è¯·è¾“å…¥ JSON æ•°ç»„');
    return;
  }

  let accounts;
  try {
    accounts = JSON.parse(jsonText);
    if (!Array.isArray(accounts)) throw new Error('å¿…é¡»æ˜¯æ•°ç»„æ ¼å¼');
  } catch(e){
    alert('âŒ JSON æ ¼å¼é”™è¯¯ï¼š' + e.message);
    return;
  }

  const result = document.getElementById('batch_result');
  result.textContent = `â³ å¼€å§‹æ‰¹é‡åˆ›å»º ${accounts.length} ä¸ªè´¦å·...\n`;

  try {
    const r = await fetch('/accounts/batch', {
      method: 'POST',
      headers: { 'content-type': 'application/json' },
      body: JSON.stringify({ accounts })
    });
    if (!r.ok) throw new Error(await r.text());
    const j = await r.json();

    result.textContent = `âœ… æ‰¹é‡åˆ›å»ºå®Œæˆï¼\n\n` +
      `æˆåŠŸï¼š${j.success} ä¸ª\n` +
      `å¤±è´¥ï¼š${j.failed} ä¸ª\n` +
      `æ€»è®¡ï¼š${j.total} ä¸ª\n\n` +
      `è¯¦ç»†ç»“æœï¼š\n${JSON.stringify(j.results, null, 2)}`;
  } catch(e){
    result.textContent = 'âŒ æ‰¹é‡åˆ›å»ºå¤±è´¥ï¼š' + e.message;
  }
}
</script>
</body>
</html>
